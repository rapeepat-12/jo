<script>
/* --- Utilities --- */
function toXeN(x){
  if(!isFinite(x)) return '∞';
  if(x===0) return '0e0';
  let e = Math.floor(Math.log10(x));
  let c = x/Math.pow(10,e);
  return Math.round(c*100)/100 + 'e'+e;
}
function statLabel(i){
  const l='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
  if(i<26) return l[i];
  if(i<52) return l[i+26-26];
  let idx=i-52;
  let first=Math.floor(idx/52);
  let second=idx%52;
  return l[first]+l[second];
}

/* --- State --- */
const state={
  stats:{a:10},
  unlocked:['a'],
  allMult:1,
  upgradePrice:100,
  unlockCost:100,
  aFlatBase:10,
  aFlatMultiplier:1,
  bMultiplier:1,
  tiers:[],
  rebirths:0,
  rebirthUnlocked:false,
  rebirthFreeAvailable:false,
  rebirthCost:null
};

/* --- Tiers --- */
function initTiers(){
  state.tiers=[];
  let t=1e6;
  for(let i=1;i<=15;i++){
    state.tiers.push({id:i,target:t,done:false});
    t=Math.pow(t,2);
    if(!isFinite(t)||t>1e308) t=1e308;
  }
}
initTiers();

/* --- Ensure stats exist --- */
function ensureStats(){
  for(let s of state.unlocked) if(!(s in state.stats)) state.stats[s]=10;
}

/* --- Tick logic --- */
let lastTime = Date.now();
function doTick(){
  const now = Date.now();
  const delta = (now - lastTime)/1000; // deltaTime in seconds
  lastTime = now;

  ensureStats();

  // Flat +10 a per second scaled by delta
  let aGain = state.aFlatBase * state.aFlatMultiplier * delta;

  // Rebirth stacked exponent
  if(state.rebirths>0){
    let exp=1.1;
    for(let i=1;i<state.rebirths;i++) exp=Math.pow(1.1,exp);
    state.stats['a']=Math.pow(state.stats['a'],exp);
  }

  state.stats['a']+=aGain;

  // Tier completion
  for(let t of state.tiers){
    if(!t.done && state.stats['a']>=t.target){
      t.done=true;
      state.aFlatMultiplier*=2;
      state.bMultiplier*=1.5;
      if(t.id===15){
        state.rebirthUnlocked=true;
        state.rebirthFreeAvailable=true;
        state.rebirthCost=t.target;
      }
    }
  }

  renderAll();
}

/* --- Actions --- */
function buyUpgrade(){
  if(state.stats.a>=state.upgradePrice){
    state.stats.a-=state.upgradePrice;
    state.allMult*=2;
    state.upgradePrice*=10;
  }
}
function unlockNext(){
  if(state.stats.a>=state.unlockCost){
    state.stats.a-=state.unlockCost;
    const label=statLabel(state.unlocked.length);
    state.unlocked.push(label);
    state.stats[label]=10;
    state.unlockCost*=10;
  }
}
function doRebirth(){
  if(!state.rebirthUnlocked) return;
  if(state.rebirthFreeAvailable){
    state.rebirths++;
    state.rebirthFreeAvailable=false;
    postRebirthReset();
    return;
  }
  if(state.rebirthCost && state.stats.a>=state.rebirthCost){
    state.stats.a-=state.rebirthCost;
    state.rebirths++;
    state.rebirthCost=Math.pow(state.rebirthCost,2.5);
    postRebirthReset();
  }
}
function postRebirthReset(){
  state.stats={a:10};
  state.unlocked=['a'];
  state.allMult=1;
  state.upgradePrice=100;
  state.unlockCost=100;
  state.aFlatMultiplier=1;
  state.bMultiplier=1.0;
  state.tiers.forEach(t=>t.done=false);
}

/* --- Reset --- */
function resetAll(){
  state.stats={a:10};
  state.unlocked=['a'];
  state.allMult=1;
  state.upgradePrice=100;
  state.unlockCost=100;
  state.aFlatMultiplier=1;
  state.bMultiplier=1;
  state.tiers.forEach(t=>t.done=false);
  state.rebirths=0;
  state.rebirthUnlocked=false;
  state.rebirthFreeAvailable=false;
  state.rebirthCost=null;
  renderAll();
}

/* --- Render UI --- */
function renderAll(){
  ensureStats();
  let html='';
  for(let s of state.unlocked){
    html+=`<div class="stat-row"><div>${s}</div><div>${toXeN(state.stats[s])}</div></div>`;
  }
  document.getElementById('statsBox').innerHTML=html;
  document.getElementById('aValue').textContent=toXeN(state.stats.a);
  document.getElementById('upgradePrice').textContent=toXeN(state.upgradePrice);
  document.getElementById('unlockCost').textContent=toXeN(state.unlockCost);
  let thtml='';
  for(let t of state.tiers){
    thtml+=`<div class="tier-row"><div>Tier ${t.id}</div><div>${toXeN(t.target)} ${t.done?'<span style="color:#34d399">✓</span>':''}</div></div>`;
  }
  document.getElementById('tiersBox').innerHTML=thtml;
  document.getElementById('rebirthCount').textContent=state.rebirths;
  document.getElementById('rebirthCost').textContent=state.rebirthFreeAvailable?'free (first)':(state.rebirthCost?toXeN(state.rebirthCost):'locked');
}

/* --- Buttons --- */
document.getElementById('upgradeBtn').addEventListener('click',buyUpgrade);
document.getElementById('unlockBtn').addEventListener('click',unlockNext);
document.getElementById('rebirthBtn').addEventListener('click',doRebirth);
document.getElementById('resetBtn').addEventListener('click',resetAll);

/* --- Game Loop --- */
setInterval(doTick,50); // tick every 50ms
renderAll();
</script>
